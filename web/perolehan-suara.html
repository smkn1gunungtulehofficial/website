<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Voting SMK N 1 Gunung Tuleh</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .animate-grow { transition: width 0.5s ease-out; }
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); }
        
        /* Custom Scrollbar for Tally Area */
        .tally-scroll::-webkit-scrollbar { width: 6px; }
        .tally-scroll::-webkit-scrollbar-track { background: #f1f5f9; }
        .tally-scroll::-webkit-scrollbar-thumb { background-color: #cbd5e1; border-radius: 20px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Components ---

        // Komponen untuk menggambar satu grup Turus (maksimal 5)
        const TallyMark = ({ count, colorClass }) => {
            // Mengubah bg-color menjadi text-color untuk garis SVG
            const strokeColor = colorClass.replace('bg-', 'text-').replace('500', '600');
            
            return (
                <svg width="28" height="24" viewBox="0 0 30 24" className={`inline-block m-0.5 ${strokeColor}`}>
                    {/* Garis 1 */}
                    {count >= 1 && <line x1="6" y1="2" x2="6" y2="22" stroke="currentColor" strokeWidth="3" strokeLinecap="round" />}
                    {/* Garis 2 */}
                    {count >= 2 && <line x1="12" y1="2" x2="12" y2="22" stroke="currentColor" strokeWidth="3" strokeLinecap="round" />}
                    {/* Garis 3 */}
                    {count >= 3 && <line x1="18" y1="2" x2="18" y2="22" stroke="currentColor" strokeWidth="3" strokeLinecap="round" />}
                    {/* Garis 4 */}
                    {count >= 4 && <line x1="24" y1="2" x2="24" y2="22" stroke="currentColor" strokeWidth="3" strokeLinecap="round" />}
                    {/* Garis 5 (Diagonal) */}
                    {count >= 5 && <line x1="4" y1="20" x2="26" y2="4" stroke="currentColor" strokeWidth="3" strokeLinecap="round" />}
                </svg>
            );
        };

        const TallySheet = ({ votes, color }) => {
            // Hitung berapa grup penuh (5) dan sisanya
            const fullGroups = Math.floor(votes / 5);
            const remainder = votes % 5;
            
            // Buat array untuk render
            const groups = Array(fullGroups).fill(5);
            if (remainder > 0) groups.push(remainder);

            return (
                <div className="w-full bg-slate-50 border border-slate-200 rounded-lg p-3 mt-4">
                    <p className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 text-left">Lembar Turus (Tally)</p>
                    <div className="flex flex-wrap justify-start items-start content-start gap-1 h-32 overflow-y-auto tally-scroll bg-white rounded border border-slate-100 p-2 shadow-inner">
                        {votes === 0 && <span className="text-xs text-slate-300 italic w-full text-center mt-10">Belum ada data</span>}
                        {groups.map((g, i) => (
                            <TallyMark key={i} count={g} colorClass={color} />
                        ))}
                    </div>
                </div>
            );
        };

        const TrophyIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="w-8 h-8 text-yellow-500"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
        );

        const UsersIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        );

        const RotateCcwIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"/><path d="M3 3v9h9"/></svg>
        );

        const CheckCircleIcon = () => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        );
        
        const SaveIcon = () => (
             <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
        );

        const App = () => {
            // State Aplikasi
            const [step, setStep] = useState('setup'); // setup, voting, finish
            const [numCandidates, setNumCandidates] = useState(2);
            const [candidates, setCandidates] = useState([
                { id: 1, name: '', votes: 0, color: 'bg-blue-500' },
                { id: 2, name: '', votes: 0, color: 'bg-red-500' },
                { id: 3, name: '', votes: 0, color: 'bg-green-500' }
            ]);
            const [logs, setLogs] = useState([]);
            const [winner, setWinner] = useState(null);

            // Warna kandidat default
            const colors = ['bg-blue-500', 'bg-red-500', 'bg-green-500', 'bg-yellow-500'];

            // Setup Awal
            useEffect(() => {
                setCandidates(prev => {
                    const newCandidates = [];
                    for (let i = 0; i < numCandidates; i++) {
                        newCandidates.push(prev[i] || { 
                            id: i + 1, 
                            name: `Calon No. Urut ${i + 1}`, 
                            votes: 0, 
                            color: colors[i] 
                        });
                    }
                    return newCandidates;
                });
            }, [numCandidates]);

            const handleNameChange = (id, newName) => {
                setCandidates(candidates.map(c => c.id === id ? { ...c, name: newName } : c));
            };

            const startVoting = () => {
                if (candidates.some(c => c.name.trim() === '')) {
                    alert("Mohon isi semua nama kandidat.");
                    return;
                }
                setStep('voting');
            };

            const addVote = (id) => {
                setCandidates(candidates.map(c => c.id === id ? { ...c, votes: c.votes + 1 } : c));
                
                const candidateName = candidates.find(c => c.id === id).name;
                const timestamp = new Date().toLocaleTimeString('id-ID');
                setLogs(prev => [{ time: timestamp, message: `Suara masuk untuk ${candidateName}` }, ...prev].slice(0, 10)); 
            };

            const finishVoting = () => {
                const sorted = [...candidates].sort((a, b) => b.votes - a.votes);
                if (sorted[0].votes === sorted[1].votes) {
                    setWinner({ name: "Seri / Draw", votes: sorted[0].votes, isTie: true });
                } else {
                    setWinner(sorted[0]);
                }
                setStep('finish');
            };

            const resetApp = () => {
                if(confirm("Apakah Anda yakin ingin mereset semua data?")) {
                    setStep('setup');
                    setCandidates(candidates.map(c => ({ ...c, votes: 0 })));
                    setLogs([]);
                    setWinner(null);
                }
            };

            const totalVotes = candidates.reduce((acc, curr) => acc + curr.votes, 0);

            // --- Render Screens ---

            if (step === 'setup') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 bg-slate-100">
                        <div className="bg-white p-8 rounded-2xl shadow-xl w-full max-w-lg border border-slate-200">
                            <div className="text-center mb-8">
                                <h1 className="text-2xl font-bold text-slate-800">Setup Pemilihan</h1>
                                <p className="text-slate-500">SMK N 1 Gunung Tuleh</p>
                            </div>

                            <div className="mb-6">
                                <label className="block text-sm font-medium text-slate-700 mb-2">Jumlah Calon</label>
                                <div className="grid grid-cols-3 gap-3">
                                    <button onClick={() => setNumCandidates(2)} className={`p-3 rounded-lg border-2 font-semibold text-sm transition ${numCandidates === 2 ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-200 hover:border-slate-300 text-slate-600'}`}>2 Calon</button>
                                    <button onClick={() => setNumCandidates(3)} className={`p-3 rounded-lg border-2 font-semibold text-sm transition ${numCandidates === 3 ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-200 hover:border-slate-300 text-slate-600'}`}>3 Calon</button>
                                    <button onClick={() => setNumCandidates(4)} className={`p-3 rounded-lg border-2 font-semibold text-sm transition ${numCandidates === 4 ? 'border-blue-500 bg-blue-50 text-blue-700' : 'border-slate-200 hover:border-slate-300 text-slate-600'}`}>4 Calon</button>
                                </div>
                            </div>

                            <div className="space-y-4 mb-8">
                                {candidates.map((candidate) => (
                                    <div key={candidate.id}>
                                        <label className="block text-xs font-uppercase text-slate-500 mb-1 tracking-wider font-bold">Nama Calon {candidate.id}</label>
                                        <input type="text" value={candidate.name} onChange={(e) => handleNameChange(candidate.id, e.target.value)} placeholder={`Masukkan Nama Calon ${candidate.id}`} className="w-full p-3 border border-slate-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none transition" />
                                    </div>
                                ))}
                            </div>

                            <button onClick={startVoting} className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 rounded-xl shadow-lg transition transform hover:scale-[1.02] flex items-center justify-center gap-2">
                                <SaveIcon className="w-5 h-5" /> Mulai Perhitungan
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-slate-50 text-slate-800 flex flex-col">
                    <header className="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-10">
                        <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
                            <div>
                                <h1 className="text-xl md:text-2xl font-bold text-slate-900 leading-tight">Perolehan Suara Pemilihan Wakil Kepala Sekolah Bidang Kesiswaan</h1>
                                <p className="text-sm text-slate-900 font-medium">SMK N 1 Gunung Tuleh</p>
                            </div>
                            <div className="flex items-center gap-4">
                                <div className="text-right hidden md:block">
                                    <span className="block text-xs text-slate-400 font-bold uppercase tracking-wider">Total Suara</span>
                                    <span className="text-2xl font-black text-slate-800">{totalVotes}</span>
                                </div>
                                {step === 'voting' && <button onClick={finishVoting} className="bg-slate-800 hover:bg-slate-900 text-white px-4 py-2 rounded-lg text-sm font-semibold transition">Selesai</button>}
                                {step === 'finish' && <button onClick={resetApp} className="text-red-600 hover:bg-red-50 px-4 py-2 rounded-lg text-sm font-semibold transition flex items-center gap-2"><RotateCcwIcon className="w-4 h-4" /> Reset</button>}
                            </div>
                        </div>
                    </header>
<h1 className="text-xl md:text-2xl font-bold text-slate-900 leading-tight">Perolehan Suara Pemilihan Wakil Kepala Sekolah Bidang Kesiswaan</h1>
                                
                    <main className="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full">
                        {step === 'finish' && winner && (
                            <div className="mb-8 p-6 bg-gradient-to-r from-yellow-100 to-amber-100 rounded-2xl border border-yellow-200 flex flex-col md:flex-row items-center justify-center text-center md:text-left gap-6 animate-fade-in shadow-inner">
                                <div className="bg-white p-4 rounded-full shadow-md"><TrophyIcon /></div>
                                <div>
                                    <h2 className="text-lg font-semibold text-yellow-800 uppercase tracking-widest">Hasil Akhir</h2>
                                    {winner.isTie ? <p className="text-3xl font-bold text-slate-800">Hasil Seri (Draw)</p> : 
                                    <div>
                                        <p className="text-3xl font-bold text-slate-900">Selamat kepada {winner.name}</p>
                                        <p className="text-yellow-700">Terpilih sebagai Wakil Kepala Sekolah Bidang Kesiswaan</p>
                                    </div>}
                                </div>
                            </div>
                        )}

                        <div className={`grid gap-6 mb-8 ${numCandidates === 4 ? 'md:grid-cols-2 xl:grid-cols-4' : numCandidates === 3 ? 'md:grid-cols-3' : 'md:grid-cols-2'}`}>
                            {candidates.map((c) => {
                                const percentage = totalVotes === 0 ? 0 : ((c.votes / totalVotes) * 100).toFixed(1);
                                const isWinner = step === 'finish' && winner && winner.id === c.id && !winner.isTie;
                                
                                return (
                                    <div key={c.id} className={`relative bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden flex flex-col transition-all duration-300 ${isWinner ? 'ring-4 ring-yellow-400 transform scale-105 z-10 shadow-2xl' : 'hover:shadow-lg'}`}>
                                        <div className={`h-2 w-full ${c.color}`}></div>
                                        <div className="p-6 flex-grow flex flex-col items-center text-center">
                                            <div className={`w-16 h-16 rounded-full flex items-center justify-center text-2xl font-bold text-white mb-4 ${c.color} shadow-lg`}>{c.id}</div>
                                            <h3 className="text-xl font-bold text-slate-800 mb-1 line-clamp-2">{c.name}</h3>
                                            
                                            {/* Progress Bar */}
                                            <div className="w-full bg-slate-100 rounded-full h-12 relative overflow-hidden mb-4 mt-2">
                                                <div className={`absolute top-0 left-0 h-full ${c.color} opacity-20 animate-grow`} style={{ width: `${percentage}%` }}></div>
                                                <div className={`absolute top-0 left-0 h-full ${c.color} animate-grow transition-all duration-500`} style={{ width: `${percentage}%` }}></div>
                                                <div className="absolute inset-0 flex items-center justify-between px-4 z-10">
                                                    <span className={`font-bold text-lg ${percentage > 50 ? 'text-white' : 'text-slate-700'}`}>{c.votes} Suara</span>
                                                    <span className={`font-bold text-lg ${percentage > 50 ? 'text-white' : 'text-slate-700'}`}>{percentage}%</span>
                                                </div>
                                            </div>

                                            {/* TALLY SHEET SECTION */}
                                            <TallySheet votes={c.votes} color={c.color} />
                                        </div>

                                        {step === 'voting' && (
                                            <button onClick={() => addVote(c.id)} className={`w-full py-4 text-white font-bold text-lg transition-colors flex items-center justify-center gap-2 active:scale-95 duration-75 ${c.color.replace('bg-', 'bg-opacity-90 hover:bg-opacity-100 bg-')}`}>
                                                <CheckCircleIcon className="w-5 h-5" /> Tambah Suara
                                            </button>
                                        )}
                                    </div>
                                )
                            })}
                        </div>

                        {/* Logs Section */}
                        <div className="bg-white rounded-xl shadow-sm border border-slate-200 p-6 max-w-3xl mx-auto">
                            <h3 className="text-sm font-bold text-slate-400 uppercase tracking-wider mb-4 flex items-center gap-2">
                                <UsersIcon className="w-4 h-4" /> Riwayat Aktivitas
                            </h3>
                            {logs.length === 0 ? (
                                <p className="text-slate-400 text-center py-4 text-sm">Belum ada suara masuk.</p>
                            ) : (
                                <div className="space-y-3">
                                    {logs.map((log, i) => (
                                        <div key={i} className="flex justify-between items-center text-sm border-b border-slate-50 last:border-0 pb-2 last:pb-0">
                                            <span className="text-slate-600 font-medium">{log.message}</span>
                                            <span className="text-slate-400 text-xs font-mono bg-slate-100 px-2 py-1 rounded">{log.time}</span>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </main>
                    
                    <footer className="bg-white border-t border-slate-200 py-6 mt-8 text-center text-slate-400 text-sm">
                        Â© {new Date().getFullYear()} Panitia Pemilihan SMK N 1 Gunung Tuleh
                    </footer>
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
